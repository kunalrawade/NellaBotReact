import React, { Component } from 'react'
import SpeechRecognizer from '../speechRecognizer'

const defaultCompare = (a, b) =>
  a.toLowerCase().trim() === b.toLowerCase().trim()

class WordDetector extends Component {
  constructor(props) {
    super(props)
    this.onResult = this.onResult.bind(this)
    this.state = {
      attempts: 0
    }
  }
  onResult({ transcript = ''}) {
    const { attempts } = this.state
    const { word, onSuccess = () => {}, onFailure = () => {}, compare=defaultCompare } = this.props
    const incrementedAttempts = attempts + 1
    const success = compare(word, transcript)

    this.setState({
      attempts: success
        ? 0
        : incrementedAttempts
    }, () => {
      const cb = success
        ? onSuccess
        : onFailure
      cb(transcript, incrementedAttempts)
    })
  }
  render() {
    const { onNotAvailable = () => {} } = this.props
    return <SpeechRecognizer onNotAvailable={onNotAvailable} onResult={this.onResult} />
  }
}

export default WordDetector
